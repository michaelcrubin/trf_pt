## Damage Ceiling {#sec-energy-intro .unnumbered}

```{r}
#| echo: false
#| message: false
#| warning: false
library(here)
invisible(capture.output(source(here("scripts", "global.R"))))
invisible(capture.output(source(here("scripts", "helpers.R"))))

# prep data
x <- get_burn()
data <- get_damage_grid() %>% left_join(x) %>% replace_na(list(burn_cost = 0))


```

::: {.callout-tip title="Summary"}
We investigate the spike at $x = 1$ in the burn cost data. This section provides a theoretical explanation, supports it with empirical evidence, and concludes that this peak represents a natural upper bound --- the **burn ceiling** --- which should be explicitly modeled.
:::

\

This section explores the **peak at** $x = 1$ observed in the burn cost data. While much of the distribution appears continuous or decaying, this spike suggests a structural limit in how losses occur --- specifically, a **maximum possible burn of 1**.

------------------------------------------------------------------------

### Theoretical Concept

In typical natural processes, losses might follow a **Gamma** or **Exponential** distribution --- both of which have a tail that extends to infinity. However, for crop losses, there is a **hard ceiling** at burn cost = 1.

Once a field is fully destroyed, no additional loss can occur --- even if the damaging event (e.g. hail, drought) continues. In effect, all excess probability mass that would fall above $x = 1$ must be **accumulated at 1**.

This leads to the formation of a spike at $x = 1$, as shown in the conceptual model below:

![](images/model-01.png)

------------------------------------------------------------------------

### Does the Probability Mass Match?

Excluding the zero-inflated component, we observe that approximately **10%--20%** of the empirical distribution's probability mass lies at exactly $x = 1$.

We can compare this to a Gamma distribution. For example:

-   Let $X \sim \text{Gamma}(\alpha = 1, \theta = 0.3)$\
-   Then $\mathbb{P}(X > 1) \approx 15\%$

This matches quite intuitively. A Gamma with $\theta = 0.3$ is a reasonable approximation for crop-level burn rates, and this theoretical "overflow" mass aligns with the spike we observe at 1.

![](images/gamma-png.PNG)

------------------------------------------------------------------------

### Hypothesis Testing

If this concept was true, then crop × municipality combinations with higher mean values would, in tendency, also have higher mass peaking at $x = 1$. We can test this by grouping the data into crop × municipality combinations into such with P Mass at and such without the same phenomena. Then we simply take the mean of each group and compare them.

```{r}
#| warning: false
#| eval: true
#| echo: true
#| message: false

tbl <- data %>%
  dplyr::filter(burn_cost > 0.15)%>%
  mutate(mass_above_1 = as.integer(burn_cost >= 1)) %>%
  group_by(crop_key, municipality_name) %>%
  summarise(mass_above_1 = sum(mass_above_1),
            has_above_1 = mass_above_1 > 0,
            n=n(),
            mean_bc = mean(burn_cost), 
            .groups = "drop") %>% 
  group_by(has_above_1) %>%
  summarise(mean_bc = mean(mean_bc), n=n(), .groups = "drop")

tbl %>%
  flextable() %>%
  theme_vanilla()


```

### Result

::: {.callout-important title="Peak at $x = 1$"}
The crop × municipality combinations, which do not have any P Mass at $x = 1$ have a mean value of `r round(tbl$mean_bc[1], 3)`, while the cells which do have P Mass at $x = 1$ show a mean value of `r round(tbl$mean_bc[2], 3)`. This is a large difference. Hence, we assume that the peak at $x = 1$ is indeed caused by the ceiling of the burn distribution.
:::
